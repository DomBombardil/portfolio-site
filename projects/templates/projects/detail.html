{% extends 'projects/base.html' %}
{% load static %}

{% block content %}
<div class="container my-5">
  
  <!-- Title -->
  <div class="row mb-4">
    <div class="col text-center">
      <h1 class="display-4 fw-bold">{{ project.title }}</h1>
    </div>
  </div>

  <div class="row justify-content-center align-items-start g-4">

    <!-- Images column (carousel) -->
<div class="col-12 col-md-5">

  {% if project.images.exists %}
    <div id="detailImagesCarousel"
         class="carousel slide detail-carousel"
         data-bs-ride="carousel"
         data-bs-interval="4000"
         data-bs-wrap="true">

      <!-- Indicators -->
      <div class="carousel-indicators">
        {% for img in project.images.all %}
          <button type="button"
                  data-bs-target="#detailImagesCarousel"
                  data-bs-slide-to="{{ forloop.counter0 }}"
                  class="{% if forloop.first %}active{% endif %}"
                  {% if forloop.first %}aria-current="true"{% endif %}
                  aria-label="Slide {{ forloop.counter }}">
          </button>
        {% endfor %}
      </div>

      <!-- Slides -->
      <div class="carousel-inner">
        {% for img in project.images.all %}
          <div class="carousel-item {% if forloop.first %}active{% endif %}">
            <div class="d-flex justify-content-center align-items-center py-3 detail-carousel-frame">
              <img src="{% static img.image %}"
                   class="img-fluid rounded-3 shadow-lg detail-image"
                   alt="{{ project.title }}"
                   data-bs-toggle="modal"
                   data-bs-target="#detailImageModal"
                   data-full-src="{% static img.image %}">
            </div>
          </div>
        {% endfor %}
      </div>
    </div>
  {% else %}
    <p class="text-muted">No images added yet.</p>
  {% endif %}

</div>
    <!-- Image modal -->
    <div class="modal fade" id="detailImageModal" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered modal-xl">
        <div class="modal-content bg-transparent border-0">
          <div class="modal-body p-0">
            <img src="" alt="{{ project.title }}" class="detail-modal-image">
          </div>
        </div>
      </div>
    </div>

    <!-- Description column -->
    <div class="col-12 col-md-5 offset-md-1">
      <p class="lead mb-4 detail-description">{{ project.description }}</p>

      {% if project.technology %}
        <p class="text-muted mb-2">
          <strong>Technologies:</strong><br>
          {{ project.technology }}
        </p>
      {% endif %}
      
      {% if project.repository_link %}
        <a href="{{ project.repository_link }}" 
           class="text-decoration-none mb-2 fs-4 text-success">
          <strong>Go to repository</strong><br></a>
      {% endif %}
    </div>

  </div>
</div>

<style>
    .detail-carousel .carousel-indicators [data-bs-target] {
      background-color: #696b68;
      opacity: 0.55;
    }

    .detail-carousel .carousel-indicators .active {
      opacity: 0.95;
    }

    .detail-image {
      width: 100%;
      height: 100%;
      max-height: 520px;
      object-fit: contain;
      cursor: zoom-in;
    }

    .detail-modal-image {
      width: 100%;
      max-height: 88vh;
      object-fit: contain;
      border-radius: 12px;
      box-shadow: 0 18px 55px rgba(0, 0, 0, 0.35);
      background-color: #0f1115;
    }

    #detailImageModal .modal-dialog {
      max-width: min(1100px, 95vw);
    }

    .detail-description {
      text-align: justify;
    }

    .detail-carousel .carousel-inner,
    .detail-carousel .carousel-item {
      height: 520px;
    }

    .detail-carousel-frame {
      height: 100%;
      width: 100%;
    }
  </style>
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const modalEl = document.getElementById('detailImageModal');
      const modalImage = modalEl.querySelector('.detail-modal-image');
      document.querySelectorAll('.detail-image').forEach(function (image) {
        image.addEventListener('click', function () {
          modalImage.src = image.dataset.fullSrc;
        });
      });
      modalEl.addEventListener('hidden.bs.modal', function () {
        modalImage.src = '';
      });
    });
  </script>
{% endblock content %}
